var g=Object.defineProperty;var _=(i,t)=>{for(var s in t)g(i,s,{get:t[s],enumerable:!0})};var h=class{static _getAttributes(t){return[...t.attributes].map(s=>s.name)}static _getNodeType(t){return t.nodeType===3?"text":t.nodeType===8?"comment":t.nodeType===11?"fragment":t.tagName.toLowerCase()}static _getNodeContent(t){return t.childNodes&&t.childNodes.length>0?null:t.textContent}static update(t,s){if(this._getNodeType(t)==="text"||this._getNodeType(s)==="text")return;let o=[...new Set([...h._getAttributes(t),...h._getAttributes(s)])],r=(e,n)=>{e.startsWith("on")?s[e.toLowerCase()]=n:s.setAttributeNS(null,e,n)},c=e=>{e.startsWith("on")?s[e.toLowerCase()]=()=>{}:s.removeAttribute(e)};for(let e of o){let n=t.getAttribute(e),u=s.getAttribute(e);!u||u!==n?r(e,n):n||c(e)}}static diff(t,s){let o=[...s.childNodes],r=[...t.childNodes];if(this._getNodeType(t)!==this._getNodeType(s)){s.replaceWith(t);return}let c=o.length-r.length;if(c>0)for(let e=c;e>0;e--)o[o.length-c].remove();r.forEach((e,n)=>{if(!o[n]){s.appendChild(e);return}if(this._getNodeType(e)!==this._getNodeType(o[n])){o[n].replaceWith(e);return}h.update(e,o[n]);let u=this._getNodeContent(e);if(u&&u!==this._getNodeContent(o[n])&&(o[n].textContent=u),o[n].childNodes.length>0&&e.childNodes.length<1){o[n].innerHTML="";return}if(o[n].childNodes.length<1&&e.childNodes.length>0){let l=document.createDocumentFragment();this.diff(e,l),o[n].appendChild(l);return}e.childNodes.length>0&&this.diff(e,o[n])})}};var a=class{subscriptions=[];initialState={};state={};reducer=null;constructor(t={},s=()=>{}){this.initialState=t,this.state=this.createStore(this.initialState),this.reducer=s}dispatch(t){let s=this.reducer(this.state,t);Object.assign(this.state,s)}getState(){return this.state}addSubscription(t){this.subscriptions.push(t)}getEventListeners(t){return this.eventListeners.filter(s=>s.name===t).map(s=>s.cb)}createStore(t){let s={set:(r,c,e)=>(r[c]=o(e),this.subscriptions.forEach(n=>n()),!0)},o=(r={})=>{if(["[object Object]","[object Array]"].includes(r.toString())){if(Array.isArray(r))for(let e=0;e<r.length;e++)r[e]=o(r[e]);else for(let[e,n]of Object.entries(r))r[e]=o(n);return new Proxy(r,s)}return r};return o(t)}};var m={};_(m,{$:()=>C,$$:()=>S,isFunction:()=>d,jsh:()=>N});var p=i=>{let t="";for(let s of i){let o=s.toLowerCase();t+=o===s?s:`-${o}`}return t.toLowerCase()},b=(i,t={},s=[])=>{let o=i==="fragment",r=o?document.createDocumentFragment():document.createElement(i);if(!o)for(let[e,n]of Object.entries(t))if(e==="style"&&n.toString()==="[object Object]"){let u=[];for(let[l,y]of Object.entries(n))u.push(`${p(l)}: ${y};`);r.setAttribute("style",u.join(" "))}else e.startsWith("on")?r[e.toLowerCase()]=n:r.setAttribute(e,n);let c=s.flat(1/0).filter(e=>e);for(let e of c)typeof e=="string"?r.appendChild(document.createTextNode(e)):r.appendChild(e);return r},N=new Proxy({},{get:(i,t)=>(s,...o)=>b(p(t),s,o)}),C=(i,t)=>i&&t?i.querySelector(t):document.body.querySelector(i),S=(i,t)=>[...i&&t?i.querySelectorAll(t):document.body.querySelectorAll(i)],d=i=>i&&typeof i=="function";var f=class extends HTMLElement{props={};store={};style="";_debounce=null;_mounted=!1;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"})}static define(t,s){customElements.define(t,s)}render(){}mount(){}unmount(){}_createStore(){this.store=this.store instanceof a?this.store:new a(this.store),this.store.addSubscription(()=>{this._updateDOM()})}connectedCallback(){this._debounce&&cancelAnimationFrame(this._debounce),this._debounce=requestAnimationFrame(()=>{this._mounted||(this._internalMount(),d(this.mount)&&this.mount())})}disconnectedCallback(){d(this.unmount)&&this.unmount()}_internalMount(){this._createProps(),this._createStore(),this._updateDOM(!0),this._trackMutations(),this._mounted=!0}_trackMutations(){new MutationObserver(()=>{this._createProps(),this._updateDOM()}).observe(this,{attributes:!0,childList:!0,subtree:!0})}_createProps(){let t={};for(let s of this.getAttributeNames())t[s]=this.getAttribute(s);t.children=[...this.childNodes],this.props=t}_updateDOM(t){let s=this.render();if(s){if(t)this.shadowRoot.appendChild(s);else{let o=h._getNodeType(s)==="fragment";h.diff(s,o?this.shadowRoot:this.shadowRoot.firstChild)}this._updateStyles()}else this.shadowRoot.innerHTML=""}_updateStyles(){this._styleElement||(this._styleElement=document.createElement("style"),this.shadowRoot.appendChild(this._styleElement));let t=d(this.style)?this.style():this.style;t&&t!==this._styleElement.textContent&&(this._styleElement.textContent=t)}};export{a as ZeroStore,m as ZeroUtils,f as default};

var m=Object.defineProperty;var y=(i,t)=>{for(var e in t)m(i,e,{get:t[e],enumerable:!0})};var h=class{static _getAttributes(t){return[...t.attributes].map(e=>e.name)}static _getNodeType(t){return t.nodeType===3?"text":t.nodeType===8?"comment":t.nodeType===11?"fragment":t.tagName.toLowerCase()}static _getNodeContent(t){return t.childNodes&&t.childNodes.length>0?null:t.textContent}static update(t,e){if(this._getNodeType(t)==="text"||this._getNodeType(e)==="text")return;let o=[...new Set([...h._getAttributes(t),...h._getAttributes(e)])],r=(s,n)=>{s.startsWith("on")?e[s.toLowerCase()]=n:e.setAttributeNS(null,s,n)},c=s=>{s.startsWith("on")?e[s.toLowerCase()]=()=>{}:e.removeAttribute(s)};for(let s of o){let n=t.getAttribute(s),a=e.getAttribute(s);!a||a!==n?r(s,n):n||c(s)}}static diff(t,e){let o=[...e.childNodes],r=[...t.childNodes];if(this._getNodeType(t)!==this._getNodeType(e)){e.replaceWith(t);return}let c=o.length-r.length;if(c>0)for(let s=c;s>0;s--)o[o.length-c].remove();r.forEach((s,n)=>{if(!o[n]){e.appendChild(s);return}if(this._getNodeType(s)!==this._getNodeType(o[n])){o[n].replaceWith(s);return}h.update(s,o[n]);let a=this._getNodeContent(s);if(a&&a!==this._getNodeContent(o[n])&&(o[n].textContent=a),o[n].childNodes.length>0&&s.childNodes.length<1){o[n].innerHTML="";return}if(o[n].childNodes.length<1&&s.childNodes.length>0){let f=document.createDocumentFragment();this.diff(s,f),o[n].appendChild(f);return}s.childNodes.length>0&&this.diff(s,o[n])})}};var u=class{subscriptions=[];initialState={};state={};reducer=()=>{};constructor(t={},e=()=>{}){this.initialState=t,this.state=this.createStore(this.initialState),this.reducer=e}dispatch(t){let e=this.reducer(this.state,t);Object.assign(this.state,e)}getState(){return this.state}addSubscription(t){this.subscriptions.push(t)}getEventListeners(t){return this.eventListeners.filter(e=>e.name===t).map(e=>e.cb)}createStore(t){let e={set:(r,c,s)=>(r[c]=o(s),this.subscriptions.forEach(n=>n()),!0)},o=(r={})=>{if(!((typeof r=="object"||Array.isArray(r))&&!(r instanceof Node||r instanceof NodeList||r===null)))return r;if(Array.isArray(r))for(let s=0;s<r.length;s++)r[s]=o(r[s]);else for(let[s,n]of Object.entries(r))r[s]=o(n);return new Proxy(r,e)};return o(t)}};var p={};y(p,{$:()=>C,$$:()=>x,isFunction:()=>d,jsh:()=>N});var g=i=>{let t="";for(let e of i){let o=e.toLowerCase();t+=o===e?e:`-${o}`}return t.toLowerCase()},_=(i,t={},e=[])=>{let o=i==="fragment",r=o?document.createDocumentFragment():document.createElement(i);if(!o)for(let[s,n]of Object.entries(t))s.startsWith("on")?r[s.toLowerCase()]=n:r.setAttribute(s,n);let c=e.flat(1/0).filter(s=>s);for(let s of c)typeof s=="string"?r.appendChild(document.createTextNode(s)):r.appendChild(s);return r},N=new Proxy({},{get:(i,t)=>(e,...o)=>_(g(t),e,o)}),C=(i,t)=>i&&t?i.querySelector(t):document.body.querySelector(i),x=(i,t)=>[...i&&t?i.querySelectorAll(t):document.body.querySelectorAll(i)],d=i=>i&&typeof i=="function";var l=class extends HTMLElement{props={};state={};store={};style="";constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"})}static define(t,e){customElements.define(t,e)}render(){}mount(){}unmount(){}_createStore(){return this.store=this.store instanceof u?this.store:new u(this.store),this.store.addSubscription(()=>{this._updateDOM()}),this.store}connectedCallback(){d(this.mount)&&(this._internalMount(),this.mount())}disconnectedCallback(){d(this.unmount)&&this.unmount()}_internalMount(){this.props=this._createProps(),this.state=this._createStore(),this._updateDOM(!0),this._trackMutations()}_trackMutations(){new MutationObserver(()=>{this._createProps(),this._updateDOM()}).observe(this,{attributes:!0,childList:!0,subtree:!0})}_createProps(){let t={};for(let e of this.getAttributeNames())t[e]=this.getAttribute(e);return t.children=[...this.childNodes],t}_updateDOM(t){let e=this.render();if(t&&e)this.shadowRoot.appendChild(e);else if(e){let o=h._getNodeType(e)==="fragment";h.diff(e,o?this.shadowRoot:this.shadowRoot.firstChild)}else this.shadowRoot.innerHTML="";this._updateStyles()}_updateStyles(){this._styleElement&&(this._styleElement=document.createElement("style"),this.shadowRoot.appendChild(this._styleElement));let t=d(this.style)?this.style():this.style;t&&t!==this._styleElement.textContent&&(this._styleElement.textContent=t)}};export{u as ZeroStore,p as ZeroUtils,l as default};
